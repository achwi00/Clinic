<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
    <head> 
        <meta charset="UTF-8"/>
        <meta name="patientPanel" content="width=device.width, initial-scale=1.0"/>
        <link rel="stylesheet" type="text/css" href="panelStyles.css"/>


        <title>loggingPanel</title>
    </head>
<body>
<header>
<div id="navbar">

    <button class="dropbtn" id="logo_pm" name="logo_pm"><img src="logo_premiummed.png" id="logo_img" height="50pxSSSSSS"></a></button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="visits" name="visits">Wizyty</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="refferals" name="refferals">Skierowania</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="prescription" name="prescription">Recepty</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="newVisit" name="newVisit"><a href="#">Umów</a></button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="log_out" name="log_out"><a href="/">Wyloguj</a></button>
    <div class="dropdown-content">
    </div>

    <script>
        document.getElementById('logo_pm').addEventListener('click', redirectToPatient);
        document.getElementById('visits').addEventListener('click', displayVisits);
        document.getElementById('refferals').addEventListener('click',displayRefferals);
        document.getElementById('prescription').addEventListener('click',displayPrescriptions);

        const urlParams1 = new URLSearchParams(window.location.search);
        //const patientId1 = urlParams1.get('patientId');

        const sessionKey = urlParams1.get('sessionKey');

        function redirectToPatient() {

            if (sessionKey) {
                const redirectUrl = `/patient?sessionKey=${sessionKey}`;
                window.location.href = redirectUrl;
            } else {
                // Handle the case when patientId is not available
                console.error('sessionKey: ', sessionKey);
            }
        }
        function displayVisits(){
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>TWOJE WIZYTY</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }
            fetch(`/patient/allvisits?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(visits => {
                        const patientDiv = document.createElement('div');
                        patientDiv.textContent = `Visits: ${visits.date} ${visits.time}`;
                        document.getElementById('patientData').appendChild(patientDiv);
                    })
                })
                .catch(error => console.error('Error fetching patient data', error))
                }

        function displayRefferals()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>TWOJE SKIEROWANIA</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }
        }
        function displayPrescriptions()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>TWOJE RECEPTY</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }
        }
    </script>


</div>

</header>
<div class="all-container">
    <div id="main-wrapper">
        <div id="title-container">
            <p>TWOJE DANE</p>
        </div>
        <!--added till /ul-->
<!--        <div id="patientData">-->
<!--            <script>-->
<!--                fetch('/patient/all')-->
<!--                    .then(response => response.json())-->
<!--                    .then(data =>{-->
<!--                        data.forEach(patient => {-->
<!--                            const patientDiv = document.createElement('div');-->
<!--                            patientDiv.textContent = `Patient: ${patient.name} ${patient.surname}`;-->
<!--                            document.getElementById('patientData').appendChild(patientDiv);-->
<!--                        });-->
<!--                        }-->
<!--                    )-->
<!--                    .catch(error => console.error('Error fetching patient data', error))-->
<!--            </script>-->

        <div id="patientData">
            <script>
                const urlParams = new URLSearchParams(window.location.search);
                const sessionKey1 = urlParams.get('sessionKey');

                fetch(`/patient/all?sessionKey=${sessionKey1}`)
                    .then(response => response.json())
                    .then(patient => {
                        const patientDiv = document.createElement('div');
                        patientDiv.textContent = `Patient: ${patient.name} ${patient.surname}`;
                        document.getElementById('patientData').appendChild(patientDiv);
                    })
                    .catch(error => console.error('Error fetching patient data', error))
            </script>
        </div>
    </div>
</div>

<footer>
    <div id="copyrights"><p>Projekt wykonany w ramach przedmiotu Inżynieria Programowania.</p></div>
    
</footer>
</body>

</html>