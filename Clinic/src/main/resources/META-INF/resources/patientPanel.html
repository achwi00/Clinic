<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
    <head> 
        <meta charset="UTF-8"/>
        <meta name="patientPanel" content="width=device.width, initial-scale=1.0"/>
        <link rel="stylesheet" type="text/css" href="panelStyles.css"/>


        <title>loggingPanel</title>
    </head>
<body>
<header>
<div id="navbar">

    <button class="dropbtn" id="logo_pm" name="logo_pm"><img src="logo_premiummed.png" id="logo_img" height="50pxSSSSSS"></a></button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="visits" name="visits">Wizyty</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="refferals" name="refferals">Skierowania</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="prescription" name="prescription">Recepty</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="history" name="history">Historia</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="newVisit" name="newVisit">Umów</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="log_out" name="log_out"><a href="/">Wyloguj</a></button>
    <div class="dropdown-content">
    </div>

    <script>
        document.getElementById('logo_pm').addEventListener('click', redirectToPatient);
        document.getElementById('visits').addEventListener('click', displayVisits);
        document.getElementById('refferals').addEventListener('click',displayRefferals);
        document.getElementById('prescription').addEventListener('click',displayPrescriptions);
        document.getElementById('history').addEventListener('click',displayHistory);
        document.getElementById('newVisit').addEventListener('click',newVisit);

        const urlParams1 = new URLSearchParams(window.location.search);
        //const patientId1 = urlParams1.get('patientId');

        const sessionKey = urlParams1.get('sessionKey');

        function redirectToPatient() {

            if (sessionKey) {
                const redirectUrl = `/patient?sessionKey=${sessionKey}`;
                window.location.href = redirectUrl;
            } else {
                // Handle the case when patientId is not available
                console.error('sessionKey: ', sessionKey);
            }
        }
        function displayVisits(){
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>NADCHODZĄCE WIZYTY</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }

            visitsContainer.style.cssText = "display: block; justify-content: center;";
            fetch(`/patient/allvisits?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(visits => {
                        const patientDiv = document.createElement('div');
                        patientDiv.classList.add("visitsData");
                        patientDiv.textContent = `Visits: ${visits.date} ${visits.time}`;
                        document.getElementById('patientData').appendChild(patientDiv);
                    })
                })
                .catch(error => console.error('Error fetching patient data', error))
                }

        function displayRefferals()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>TWOJE SKIEROWANIA</p>';
            const refferalContainer = document.getElementById('patientData');
            while(refferalContainer.firstChild){
                refferalContainer.firstChild.remove();
            }

            refferalContainer.style.cssText = "display: block; justify-content: center;";
            fetch(`/patient/allrefferals?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(refferal => {
                        const patientDiv = document.createElement('div');
                        patientDiv.textContent = `Refferal: ${refferal.reffId} ${refferal.description} ${refferal.type}`;
                        document.getElementById('patientData').appendChild(patientDiv);
                    })
                })
                .catch(error => console.error('Error fetching patient data', error))
        }
        function displayPrescriptions()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>TWOJE RECEPTY</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }
        }

        function displayHistory()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>HISTORIA WIZYT</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }

        }
        function newVisit()
        {
            const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>UMÓW NOWĄ WIZYTĘ</p>';
            const visitsContainer = document.getElementById('patientData');
            while(visitsContainer.firstChild){
                visitsContainer.firstChild.remove();
            }
        }
    </script>


</div>

</header>
<div class="all-container">
    <div id="main-wrapper">
        <div id="title-container">
            <p>TWOJE DANE</p>
        </div>

        <div id="patientData">

                <script>
                    const urlParams = new URLSearchParams(window.location.search);
                    const sessionKey1 = urlParams.get('sessionKey');

                    const personalInfoContainer = document.createElement('div');
                    personalInfoContainer.id = 'personalInfoContainer';
                    document.getElementById('patientData').appendChild(personalInfoContainer);

                    const patientIcon = document.createElement('div');
                    patientIcon.id = 'patientIcon';
                    patientIcon.innerHTML = '<i class=\"bi bi-person-fill\"></i>';
                    document.getElementById('personalInfoContainer').appendChild(patientIcon);

                    const patientData = document.getElementById('patientData');
                    patientData.style.cssText = "display: flex; justify-content: center;";

                    fetch(`/patient/all?sessionKey=${sessionKey1}`)
                        .then(response => response.json())
                        .then(patient => {
                            const patientDiv = document.createElement('div');
                            patientDiv.textContent = `Patient: ${patient.name} ${patient.surname}`;
                            document.getElementById('personalInfoContainer').appendChild(patientDiv);
                        })
                        .catch(error => console.error('Error fetching patient data', error))
                </script>


        </div>
    </div>
</div>

<footer>
    <div id="copyrights"><p>Projekt wykonany w ramach przedmiotu Technologie Obiektowe.</p></div>
    
</footer>
</body>

</html>