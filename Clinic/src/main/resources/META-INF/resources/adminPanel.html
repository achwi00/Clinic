<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="adminPanel" content="width=device.width, initial-scale=1.0"/>
  <link rel="stylesheet" type="text/css" href="panelStyles.css"/>


  <title>adminPanel</title>
</head>
<body>
<header>
  <div id="navbar">

    <button class="dropbtn" id="logo_pm" name="logo_pm"><img src="logo_premiummed.png" id="logo_img" height="50pxSSSSSS"></button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="searchVisits" name="searchVisits">Wyszukaj wizytę</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="addDoctor" name="addDoctor">Dodawanie lekarza</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="doctors" name="doctors">Lekarze</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="clinics" name="clinics">Przychodnie </button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="log_out" name="log_out"><a href="/">Wyloguj</a></button>
    <div class="dropdown-content">
    </div>
    <script>

      let sessionKey;
      const urlParams1 = new URLSearchParams(window.location.search);
      if (urlParams1.has('sessionKey')) {
        sessionKey = urlParams1.get('sessionKey');
      }
      document.getElementById('logo_pm').addEventListener('click', redirectToAdmin);
      document.getElementById('searchVisits').addEventListener('click', searchVisits);
      document.getElementById('addDoctor').addEventListener('click', formAddDoctor);
      document.getElementById('doctors').addEventListener('click', displayDoctors);
      document.getElementById('clinics').addEventListener('click', displayClinics);

      function redirectToAdmin() {

        if (sessionKey) {
          const redirectUrl = `/admin?sessionKey=${sessionKey}`;
          window.location.href = redirectUrl;
        } else {
          // Handle the case when adminId is not available
          console.error('sessionKey: ', sessionKey);
        }
      }
      function searchVisits(){
        const titleContainer = document.getElementById('title-container');
      titleContainer.innerHTML = '<p>WYSZUKAJ WIZYTY</p>';

      // Clear the container
      clearContainer();

      // Create the visit container
      const visitContainer = document.getElementById('adminData');
      visitContainer.id ='visitContainer';
      const visitForm = document.createElement('form');
      //visitForm.id='visitForm';
      visitForm.action = 'admin/submit-visit';
      visitForm.method = 'POST';
      visitContainer.appendChild(visitForm);

      // Create an input field for doctorId
      const doctorIdInput = document.createElement('input');
      doctorIdInput.type = 'number';
      doctorIdInput.placeholder = 'Doctor ID';
      doctorIdInput.id = 'doctorIdInput';

      // Create a search button
      const searchButton = document.createElement('button');
      searchButton.textContent = 'Szukaj';
      searchButton.addEventListener('click', getVisitsByDoctorId);

      // Append the input field and search button to the visit container
      visitForm.appendChild(doctorIdInput);
      visitForm.appendChild(searchButton);
      }

      function getVisitsByDoctorId() {
      const doctorId = document.getElementById('doctorIdInput').value;
      const visitContainer = document.getElementById('visitContainer');
      visitContainer.id='visitContainer';
      // Clear the visit container
      while (visitContainer.firstChild) {
        visitContainer.firstChild.remove();
      }

      const formData = new FormData();
      formData.append('doctorId', doctorId);

      // Fetch visits from the API
      //fetch(`/admin/admin/submit-visit?doctorId=${doctorId}`)
        fetch('/admin/submit-visit',{
            method: 'POST',
            body: formData})
          .then(response => response.json())
          .then(data => {
              data.forEach(visit => {
                  const visitDiv = document.createElement('div');
                  visitDiv.textContent = `Wizyta id: ${visit.visitId}, data: ${visit.date}, lekarz id: ${visit.doctor.id}, pacjent id: ${visit.patient.id}, status: ${visit.status} `;
                 //visitContainer.appendChild(visitDiv);
                  document.getElementById('visitContainer').appendChild(visitDiv);
              });
          })
          .catch(error => console.error('Error fetching visits', error));
        }


        function displayDoctors(){
        const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>LISTA WSZYSTKICH LEKARZY</p>';
            clearContainer();
            const doctorsContainer = document.getElementById('adminData');

            doctorsContainer.id ='doctorsContainer';
            doctorsContainer.style.cssText = "display: block; justify-content: center;text-align: center;margin-top: 1em;";

            fetch(`/admin/alldoctors?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(doctors => {
                        const adminDiv = document.createElement('div');
                        adminDiv.textContent = `dr. ${doctors.name} ${doctors.surname} specjalizacja: ${doctors.specialisation}`;
                        document.getElementById('doctorsContainer').appendChild(adminDiv);
                        //doctorsContainer.appendChild(adminDiv);
                    })
                })
                .catch(error => console.error('Error fetching admin data', error))
        }
        function displayClinics(){
        const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>LISTA PRZYCHODNI LEKARSKICH</p>';
            //clearContainer();
            const clinicsContainer = document.getElementById('adminData');
            while(clinicsContainer.firstChild){
                clinicsContainer.firstChild.remove();
            }
            clinicsContainer.id ='clinicsContainer';

            clinicsContainer.style.cssText = "display: block; justify-content: center;text-align: center;margin-top: 1em;";

            fetch(`/admin/allclinics?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(clinics => {
                        const adminDiv = document.createElement('div');
                        adminDiv.textContent = `Przychodnia Lekarska:  ${clinics.departmentName}`;
                        document.getElementById('clinicsContainer').appendChild(adminDiv);
                    })
                })
                .catch(error => console.error('Error fetching admin data', error))
        }

        function formAddDoctor(){
        const titleContainer = document.getElementById('title-container');
        titleContainer.innerHTML = '<p>DODAJ NOWEGO LEKARZA</p>';
        const targetContainer = document.getElementById('adminData');
        clearContainer();
        targetContainer.id='targetContainer';
        targetContainer.style.cssText = "display: flex; justify-content:center";

        const formsContainer = document.createElement('div');
        formsContainer.id = 'formsContainer';
        document.getElementById('targetContainer').appendChild(formsContainer);
        const allInputsHolder = document.createElement('div');
        allInputsHolder.id = 'allInputsHolder';
        formsContainer.appendChild(allInputsHolder);

          //create form
        const doctorForm = document.createElement('form');
        doctorForm.action = '/admin/submit-doctor';
        doctorForm.method = 'POST';

          //name
        const inputBox1 = document.createElement('div');
        inputBox1.classList.add("inputBox");
        doctorForm.appendChild(inputBox1);

        const nameHeader = document.createElement('h3');
        nameHeader.textContent = 'Name';
        inputBox1.appendChild(nameHeader);

        const NameInput = document.createElement('input');
        NameInput.type = 'text';
        NameInput.placeholder = 'Name';
        NameInput.required = true;
        NameInput.name = 'name';
        inputBox1.appendChild(NameInput);

          //surname
        const inputBox2 = document.createElement('div');
        inputBox2.classList.add("inputBox");
        doctorForm.appendChild(inputBox2);

        const surnameHeader = document.createElement('h3');
        surnameHeader.textContent = 'Nazwisko: ';
        inputBox2.appendChild(surnameHeader);

        const surnameInput = document.createElement('input');
        surnameInput.type = 'text';
        surnameInput.placeholder = 'Surname';
        surnameInput.required = true;
        surnameInput.name = 'surname';
        inputBox2.appendChild(surnameInput);

          //e-mail
        const inputBox3 = document.createElement('div');
        inputBox3.classList.add("inputBox");
        doctorForm.appendChild(inputBox3);

        const emailHeader = document.createElement('h3');
        emailHeader.textContent = 'E-mail: ';
        inputBox3.appendChild(emailHeader);

        const emailInput = document.createElement('input');
        emailInput.type = 'email';
        emailInput.placeholder = 'Email';
        emailInput.required = true;
        emailInput.name = 'email';
        inputBox3.appendChild(emailInput);

          //password
        const inputBox4 = document.createElement('div');
        inputBox4.classList.add("inputBox");
        doctorForm.appendChild(inputBox4);

        const passwordHeader = document.createElement('h3');
        passwordHeader.textContent = 'Password: ';
        inputBox4.appendChild(passwordHeader);

        const passwordInput = document.createElement('input');
        passwordInput.type = 'text';
        passwordInput.placeholder = 'Password';
        passwordInput.required = true;
        passwordInput.name = 'password';
        inputBox4.appendChild(passwordInput);

          //nr PWZ
        const inputBox5 = document.createElement('div');
        inputBox5.classList.add("inputBox");
        doctorForm.appendChild(inputBox5);

        const pwzHeader = document.createElement('h3');
        pwzHeader.textContent = 'Numer PWZ: ';
        inputBox5.appendChild(pwzHeader);

        const pwzInput = document.createElement('input');
        pwzInput.type = 'text';
        pwzInput.placeholder = 'Numer PWZ';
        pwzInput.required = true;
        pwzInput.name = 'PWZnr';
        inputBox5.appendChild(pwzInput);

          //specjalizacja
        const inputBox6 = document.createElement('div');
        inputBox6.classList.add("inputBox");
        doctorForm.appendChild(inputBox6);

        const specialisationHeader = document.createElement('h3');
        specialisationHeader.textContent = 'Specjalizacja: ';
        inputBox5.appendChild(specialisationHeader);

        const specialisationInput = document.createElement('input');
        specialisationInput.type = 'text';
        specialisationInput.placeholder = 'specjalizacja';
        specialisationInput.required = true;
        specialisationInput.name = 'specialisation';
        inputBox6.appendChild(specialisationInput);

            //listofClinic
            const inputBox7 = document.createElement('div');
            inputBox7.classList.add("inputBox");
            doctorForm.appendChild(inputBox7);

            const listHeader = document.createElement('h3');
            listHeader.textContent = "Przychodnie: ";
            inputBox7.appendChild(listHeader);

          fetch(`/admin/allclinics?sessionKey=${sessionKey}`)
                  .then(response => response.json())
                  .then(data => {
                    data.forEach(clinic => {
                      const checkboxDiv = document.createElement('div');
                      checkboxDiv.classList.add("clinicCheckbox");
                      const clinics = document.createElement('input');
                      clinics.type = 'checkbox';
                      clinics.required = false;
                      clinics.name = 'clinics';
                      clinics.value = clinic.clinicId;
                      const clinicLabel = document.createElement('label');
                      clinicLabel.textContent = clinic.departmentName;
                      checkboxDiv.appendChild(clinics);
                      checkboxDiv.appendChild(clinicLabel);
                      inputBox7.appendChild(checkboxDiv);
                    });
                  })
                    .catch(error => console.error('Error fetching all clinics to form', error));

            //inputBox7.appendChild(listInput);

            const buttonAddDoctor = document.createElement('button');
          buttonAddDoctor.type = 'submit';
          buttonAddDoctor.textContent = 'Zapisz';
          buttonAddDoctor.id = 'buttonAddDoctor';

          /*buttonAddDoctor.addEventListener('click', function(event){
            event.preventDefault(); // Prevent the default form submission
            });*/

            doctorForm.appendChild(buttonAddDoctor);
            allInputsHolder.appendChild(doctorForm);
          //document.getElementById('formsContainer').appendChild(visitForm);

        }
        function clearContainer()
        {
            const targetContainer = document.getElementById('adminData');
            while(targetContainer.firstChild){
              targetContainer.firstChild.remove();
            }
        }
    </script>

  </div>

</header>
<div class="all-container">
  <div id="main-wrapper">
    <div id="title-container">
      <p>TWOJE DANE</p>
    </div>
    <div id="adminData">
      <script>
          const urlParams = new URLSearchParams(window.location.search);
          const sessionKey1 = urlParams.get('sessionKey');

          const personalInfoContainer = document.createElement('div');
          personalInfoContainer.id = 'personalInfoContainer';
          document.getElementById('adminData').appendChild(personalInfoContainer);

          const adminData = document.getElementById('adminData');
          adminData.style.cssText = "display: flex; justify-content: center;margin-top: 1em;";

          fetch(`/admin/all?sessionKey=${sessionKey1}`)
             .then(response => response.json())
             .then(admin => {
                            const adminDiv = document.createElement('div');
                            adminDiv.textContent = `Admin: ${admin.name} ${admin.surname}`;
                            document.getElementById('personalInfoContainer').appendChild(adminDiv);
                        })
             .catch(error => console.error('Error fetching admin data', error))
      </script>

    </div>
  </div>
</div>

<footer>
  <div id="copyrights"><p>Projekt wykonany przez studentki Politechniki Krakowskiej: Agnieszkę Biel i Aleksandrę Chwierut.</p></div>

</footer>
</body>

</html>