<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="adminPanel" content="width=device.width, initial-scale=1.0"/>
  <link rel="stylesheet" type="text/css" href="panelStyles.css"/>


  <title>adminPanel</title>
</head>
<body>
<header>
  <div id="navbar">

    <button class="dropbtn" id="logo_pm" name="logo_pm"><img src="logo_premiummed.png" id="logo_img" height="50pxSSSSSS"></button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="searchVisits" name="searchVisits">Wyszukaj wizytę</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="addDoctor" name="addDoctor">Dodawanie lekarza</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="doctors" name="doctors">Lekarze</button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="clinics" name="clinics">Przychodnie </button>
    <div class="dropdown-content">
    </div>

    <button class="dropbtn" id="log_out" name="log_out"><a href="/">Wyloguj</a></button>
    <div class="dropdown-content">
    </div>
    <script>

        let sessionKey;
        const urlParams1 = new URLSearchParams(window.location.search);
        if (urlParams1.has('sessionKey')) {
          sessionKey = urlParams1.get('sessionKey');
        }
        document.getElementById('logo_pm').addEventListener('click', redirectToAdmin);
        document.getElementById('searchVisits').addEventListener('click', searchVisits);
        document.getElementById('addDoctor').addEventListener('click', formAddDoctor);
        document.getElementById('doctors').addEventListener('click', displayDoctors);
        document.getElementById('clinics').addEventListener('click', displayClinics);

        function redirectToAdmin() {

            if (sessionKey) {
                const redirectUrl = `/admin?sessionKey=${sessionKey}`;
                window.location.href = redirectUrl;
            } else {
                // Handle the case when adminId is not available
                console.error('sessionKey: ', sessionKey);
            }
        }

    function searchVisits(){
    const titleContainer = document.getElementById('title-container');
    titleContainer.innerHTML = '<p>WYSZUKAJ WIZYTY</p>';

    // Clear the container
    clearContainer();

    // Create the visit container
    const visitContainer = document.getElementById('adminData');
    visitContainer.id ='visitContainer';
    const visitForm = document.createElement('form');
    //visitForm.id='visitForm';
    visitForm.action = 'admin/admin/submit-visit';
    visitForm.method = 'POST';
    visitContainer.appendChild(visitForm);

    // Create an input field for doctorId
    const doctorIdInput = document.createElement('input');
    doctorIdInput.type = 'number';
    doctorIdInput.placeholder = 'Doctor ID';
    doctorIdInput.id = 'doctorIdInput';

    // Create a search button
    const searchButton = document.createElement('button');
    searchButton.textContent = 'Szukaj';
    searchButton.addEventListener('click', getVisitsByDoctorId);

    // Append the input field and search button to the visit container
    visitForm.appendChild(doctorIdInput);
    visitForm.appendChild(searchButton);
    }

    function getVisitsByDoctorId() {
    const doctorId = document.getElementById('doctorIdInput').value;
    const visitContainer = document.getElementById('visitContainer');

    // Clear the visit container
    while (visitContainer.firstChild) {
        visitContainer.firstChild.remove();
    }

    const formData = new FormData();
    formData.append('doctorId', doctorId);

    // Fetch visits from the API
    //fetch(`/admin/admin/submit-visit?doctorId=${doctorId}`)
    fetch('/admin/admin/submit-visit',{
      method: 'POST',
      body: formData})
        .then(response => response.json())
        .then(data => {
            data.forEach(visit => {
                const visitDiv = document.createElement('div');
                visitDiv.textContent = `Wizyta id: ${visit.id}, lekarz id: ${visit.doctorId}, pacjent id: ${visit.patientId}`;
                //visitContainer.appendChild(visitDiv);
                document.getElementById('adminData').appendChild(visitDiv);
            });
        })
        .catch(error => console.error('Error fetching visits', error));
}


        function displayDoctors(){
        const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>LISTA WSZYSTKICH LEKARZY</p>';
            //clearContainer();
            const doctorsContainer = document.getElementById('adminData');
            while(doctorsContainer.firstChild){
                doctorsContainer.firstChild.remove();
            }
            doctorsContainer.id ='doctorsContainer';
            doctorsContainer.style.cssText = "display: block; justify-content: center;text-align: center;margin-top: 1em;";

            fetch(`/admin/alldoctors?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(doctors => {
                        const adminDiv = document.createElement('div');
                        adminDiv.textContent = `dr. ${doctors.name} ${doctors.surname} specjalizacja: ${doctors.specialisation}`;
                        document.getElementById('doctorsContainer').appendChild(adminDiv);
                        //doctorsContainer.appendChild(adminDiv);
                    })
                })
                .catch(error => console.error('Error fetching admin data', error))
        }
        function displayClinics(){
        const titleContainer = document.getElementById('title-container');
            titleContainer.innerHTML = '<p>LISTA PRZYCHODNI LEKARSKICH</p>';
            //clearContainer();
            const clinicsContainer = document.getElementById('adminData');
            while(clinicsContainer.firstChild){
                clinicsContainer.firstChild.remove();
            }
            clinicsContainer.id ='clinicsContainer';

            clinicsContainer.style.cssText = "display: block; justify-content: center;text-align: center;margin-top: 1em;";

            fetch(`/admin/allclinics?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(clinics => {
                        const adminDiv = document.createElement('div');
                        adminDiv.textContent = `Przychodnia Lekarska:  ${clinics.departmentName}`;
                        document.getElementById('clinicsContainer').appendChild(adminDiv);
                    })
                })
                .catch(error => console.error('Error fetching admin data', error))
        }

        function formAddDoctor(){
        const titleContainer = document.getElementById('title-container');
        titleContainer.innerHTML = '<p>DODAJ NOWEGO LEKARZA</p>';
        const targetContainer = document.getElementById('adminData');
        clearContainer();
        targetContainer.id='targetContainer';
        targetContainer.style.cssText = "display: flex; justify-content:center";

            //adding new stuff: adding formsContainer to patientData
            const formsContainer = document.createElement('div');
            formsContainer.id = 'formsContainer';
            document.getElementById('targetContainer').appendChild(formsContainer);
            formsContainer.innerHTML='formsContainer';

            const allInputsHolder = document.createElement('div');
            allInputsHolder.id = 'allInputsHolder';
            formsContainer.appendChild(allInputsHolder);
            allInputsHolder.innerHTML='allInputsHolder';

            //creating forms
            const doctorForm = document.createElement('form');
            doctorForm.action = '/submit-doctor';
            doctorForm.method = 'POST';

            //creating inputBox, adding it to the forms
            const inputBox1 = document.createElement('div');
            inputBox1.classList.add("inputBox");
            doctorForm.appendChild(inputBox1);

            const startHeader = document.createElement('h2');
            nameHeader.textContent = 'Name';
            inputBox1.appendChild(nameHeader);

            const startNameInput = document.createElement('input');
            startNameInput.type = 'text';
            startNameInput.placeholder = 'Name';
            startNameInput.required = true;
            startNameInput.name = 'nameInput';
            inputBox1.appendChild(nameInput);

            const inputBox2 = document.createElement('div');
            inputBox2.classList.add("inputBox");
            doctorForm.appendChild(inputBox2);

            const surnameHeader = document.createElement('h2');
            surnameHeader.textContent = 'Nazwisko: ';
            inputBox2.appendChild(surnameHeader);

            const surnameInput = document.createElement('input');
            endDateInput.type = 'text';
            endDateInput.placeholder = 'Surname';
            endDateInput.required = true;
            endDateInput.name = 'SurnameInput';
            inputBox2.appendChild(SurnameInput);
            //e-mail
            const inputBox3 = document.createElement('div');
            inputBox3.classList.add("inputBox");
            doctorForm.appendChild(inputBox3);

            const emailHeader = document.createElement('h2');
            emailHeader.textContent = 'E-mail: ';
            inputBox3.appendChild(emailHeader);

            const emailInput = document.createElement('input');
            endDateInput.type = 'email';
            endDateInput.placeholder = 'Email';
            endDateInput.required = true;
            endDateInput.name = 'emailInput';
            inputBox3.appendChild(emailInput);

            //password
            const inputBox4 = document.createElement('div');
            inputBox4.classList.add("inputBox");
            doctorForm.appendChild(inputBox4);

            const passwordHeader = document.createElement('h2');
            passwordHeader.textContent = 'Password: ';
            inputBox4.appendChild(passwordHeader);

            const passwordInput = document.createElement('input');
            passwordInput.type = 'text';
            passwordInput.placeholder = 'Password';
            passwordInput.required = true;
            passwordInput.name = 'passwordInput';
            inputBox4.appendChild(passwordInput);

            //listofClinic
            const inputBox5 = document.createElement('div');
            inputBox5.classList.add("inputBox");
            doctorForm.appendChild(inputBox5);

            const listHeader = document.createElement('h2');
            listHeader.textContent = "Kliniki: ";
            inputBox5.appendChild(listHeader);

            const listInput = document.createElement('select');
            listInput.type = 'select';
            listInput.required = true;
            listInput.name = 'listInput';
            listInput.id = 'listInput';

            //dropdown specialisations logic here:
            fetch(`/admin/allclinics?sessionKey=${sessionKey}`)
                .then(response => response.json())
                .then(data => {
                    const clinicsDropdown = document.getElementById('listInput');
                    // Clear existing options
                    //add each option to the dropdown
                    data.forEach(clinics => {
                        const option = document.createElement('option');
                        option.value = clinics;
                        option.textContent = clinics;
                        clinicsDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching specializations', error));

        }
        function clearContainer()
        {
            const targetContainer = document.getElementById('adminData');
            while(targetContainer.firstChild){
                targetContainer.firstChild.remove();
            }
        }
    </script>

  </div>

</header>
<div class="all-container">
  <div id="main-wrapper">
    <div id="title-container">
      <p>TWOJE DANE</p>
    </div>
    <div id="adminData">
      <script>
          const urlParams = new URLSearchParams(window.location.search);
          const sessionKey1 = urlParams.get('sessionKey');

          const personalInfoContainer = document.createElement('div');
          personalInfoContainer.id = 'personalInfoContainer';
          document.getElementById('adminData').appendChild(personalInfoContainer);

          const adminData = document.getElementById('adminData');
          adminData.style.cssText = "display: flex; justify-content: center;margin-top: 1em;";

          fetch(`/admin/all?sessionKey=${sessionKey1}`)
             .then(response => response.json())
             .then(admin => {
                            const adminDiv = document.createElement('div');
                            adminDiv.textContent = `Admin: ${admin.name} ${admin.surname}`;
                            document.getElementById('personalInfoContainer').appendChild(adminDiv);
                        })
             .catch(error => console.error('Error fetching admin data', error))
      </script>

    </div>
  </div>
</div>

<footer>
  <div id="copyrights"><p>Projekt wykonany przez studentki Politechniki Krakowskiej: Agnieszkę Biel i Aleksandrę Chwierut.</p></div>

</footer>
</body>

</html>